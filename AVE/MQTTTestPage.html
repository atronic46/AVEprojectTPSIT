<html>
	<head>
		<title> MQTT Test Page </title>
		<style type="text/css">
body
{
	background-color: #4080C0;
	font-family: arial
}		

#received, #transmitted
{
	background-color: #E0C040;
}
		</style>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
		<script>
function mqttConnect()
{
	var mqtt_server = document.getElementById("server").value;
	var mqtt_port = Number(document.getElementById("port").value);
	var mqtt_client = document.getElementById("client").value;

	client = new Paho.MQTT.Client(mqtt_server, mqtt_port, mqtt_client);
	client.connect({onSuccess:onConnect});

	document.getElementById("status").innerHTML = "Trying to connect...";
}

function onConnect()
{
	document.getElementById("status").innerHTML = "Connected";
}

function mqttSubscribe()
{
	var mqtt_topic = document.getElementById("subtopic").value;

	client.onMessageArrived = onMessageArrived;
	client.subscribe(mqtt_topic);
	
	document.getElementById("subscribe").innerHTML += "Subscribe to topic: " + mqtt_topic + "<br>";
}

function onMessageArrived(message)
{
	document.getElementById("received").innerHTML += message.destinationName + ": " + message.payloadString + "<br>";
}

function mqttMessage()
{
	var mqtt_topic = document.getElementById("topic").value;
	var mqtt_msg = document.getElementById("message").value;
	
	message = new Paho.MQTT.Message(mqtt_msg);
	message.destinationName = mqtt_topic;
	client.send(message);
	
	document.getElementById("transmitted").innerHTML += mqtt_topic + ": " + mqtt_msg + "<br>";
}
		</script>
	</head>
	<body>
		<h1>MQTT Test Page</h1>
		<table>
			<tr><td>Server:</td><td><input type='text' id='server' value='test.mosquitto.org'></td></tr>
			<tr><td>Port:  </td><td><input type='text' id='port' value='8080'></td></tr>
			<tr><td>Client:</td><td><input type='text' id='client'></td></tr>
			<tr><td><input type='button' value='Connect' onclick='mqttConnect()'></td><td id='status'></td></tr>
			<tr><td colspan='2'><br></td></tr>
			
			<tr><td>Topic:</td><td><input type='text' id='subtopic'></td></tr>
			<tr><td><input type='button' value='Subscribe' onclick='mqttSubscribe()'></td><td id='subscribe'></td></tr>
			<tr><td colspan='2' id='received'></td></tr>
			<tr><td colspan='2'><br></td></tr>
			
			<tr><td>Topic:</td><td><input type='text' id='topic'></td></tr>
			<tr><td>Message:</td><td><input type='text' id='message' size='100'></td></tr>
			<tr><td><input type='button' value='Send' onclick='mqttMessage()'></td></tr>
			<tr><td colspan='2' id='transmitted'></td></tr>
		</table>
	</body>
</html>